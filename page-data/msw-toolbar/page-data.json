{"componentChunkName":"component---src-templates-post-jsx","path":"/msw-toolbar/","result":{"data":{"site":{"siteMetadata":{"title":"Team Growing"}},"markdownRemark":{"id":"d186e685-6156-5a77-a167-9ec803e07f80","excerpt":"mocking에 대해 알아보자 1. mocking 이란? 모킹은 특정 객체의 실제 구현 대신 가짜 객체를 사용해서 그 객체의 행동을 모방하는 프로세스입니다. 이러한 가짜 객체를 'mock 객체'라고 해요. Mock 객체는 우리의 서비스가 의존하고 있는 외부 시스템이나 복잡한 로직 없이도 동작할 수 있도록 해줍니다. 예를 들어, 서비스에서 사용하고 있는 실…","html":"<h2>mocking에 대해 알아보자</h2>\n<h3><strong>1. mocking 이란?</strong></h3>\n<p><strong>모킹</strong>은 특정 객체의 실제 구현 대신 가짜 객체를 사용해서 그 객체의 행동을 모방하는 프로세스입니다. 이러한 가짜 객체를 'mock 객체'라고 해요. Mock 객체는 우리의 서비스가 의존하고 있는 외부 시스템이나 복잡한 로직 없이도 동작할 수 있도록 해줍니다. 예를 들어, 서비스에서 사용하고 있는 실제 DB를 거치지 않고 가짜 데이터를 사용하는 것입니다.</p>\n<h3><strong>2. mocking의 이점</strong></h3>\n<p>그럼 어떤 이점이 있길래 mocking을 하는 걸까요? mocking의 장점을 3가지로 정리해볼 수 있어요.</p>\n<ol>\n<li>\n<p><strong>외부 서비스나 리소스에 대한 의존성 제거</strong></p>\n<p>→ 외부 API나 데이터베이스와 같은 외부 서비스, 네트워크 지연 등에 영향을 받지 않고 테스트를 수행할 수 있습니다.</p>\n</li>\n<li>\n<p><strong>어려운 조건과 상황의 시뮬레이션</strong></p>\n<p>→ 네트워크 오류나 데이터베이스 연결 오류 등과 같은 예외 상황이나 희귀한 상황을 임의로 재현해서 특정 상황에서 애플리케이션이 어떻게 동작하는 지 테스트할 수 있습니다.</p>\n</li>\n<li>\n<p><strong>비용 절감</strong></p>\n<p>→ 테스트를 할 때 실제 서버를 이용하면 서버 비용이 부담이 될 수 있어요. 하지만 mocking을 통해 수행하면 실제 리소스를 사용하지 않으므로 테스트 비용을 절감할 수 있습니다.</p>\n</li>\n</ol>\n<h3><strong>3. 우리가 모킹을 결정한 이유</strong></h3>\n<p>그렇다면 그로잉 프로젝트에서 서버 데이터를 모킹 하기로 한 이유는 무엇일까요?</p>\n<p>저희는 비용 문제로 인해 서버를 계속 켜놓을 수 없었어요. 그리고 각 기능별로 에러와 로딩 상황에 대한 UI를 수정할 예정이라 이런 상황들을 빠르게 재현하고 적절히 처리하는데 mocking의 도움을 받으면 좋겠다는 생각을 했어요. 마지막으로, 후에 테스트 코드를 작성할 때 mocking 데이터를 재활용할 수 있다는 점도 저희의 결정에 영향을 줬습니다.</p>\n<h2>mocking 도구 비교 분석</h2>\n<h3>다른 라이브러리 소개</h3>\n<ul>\n<li>\n<p><strong>Nock</strong></p>\n<ul>\n<li>Node.js 환경에서 HTTP 요청을 mocking하고, 테스팅할 수 있는 강력한 라이브러리에요. 주로 서버 사이드에서 API 호출을 가로채고 대체 응답을 제공하는 데 사용됩니다.</li>\n</ul>\n</li>\n<li>\n<p><strong>Mirage JS</strong></p>\n<ul>\n<li>백엔드 없이도 클라이언트 사이드에서 API를 모의할 수 있게 해주는 라이브러리에요. Mirage는 자체 ORM과 라우터를 제공하여 실제 백엔드 서버를 흉내낼 수 있습니다.</li>\n</ul>\n</li>\n<li>\n<p><strong>JSON Server</strong></p>\n<ul>\n<li>간단한 REST API를 빠르게 프로토타이핑하고자 할 때 유용한 툴로, JSON 파일을 데이터베이스로 사용하여 실제 서버처럼 작동하는 가짜 API 서버를 생성할 수 있습니다.</li>\n</ul>\n</li>\n</ul>\n<h3>라이브러리 비교</h3>\n<ol>\n<li>\n<p><strong>API support</strong></p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th>MSW</th>\n<th>Nock</th>\n<th>Mirage</th>\n<th>JSON server</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>REST API</td>\n<td>✅</td>\n<td>✅</td>\n<td>✅</td>\n<td>✅</td>\n</tr>\n<tr>\n<td>GraphQL API</td>\n<td>✅</td>\n<td>⛔</td>\n<td>부분 지원(써드파티 애드온을 통해)</td>\n<td>⛔</td>\n</tr>\n<tr>\n<td>WebSocket API</td>\n<td>⛔</td>\n<td>⛔</td>\n<td>⛔</td>\n<td>⛔</td>\n</tr>\n</tbody>\n</table>\n</li>\n<li>\n<p><strong>Supported environment</strong></p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th>MSW</th>\n<th>Nock</th>\n<th>Mirage</th>\n<th>JSON server</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Node.js</td>\n<td>✅</td>\n<td>✅</td>\n<td>부분 지원(주로 프런트엔드 위주, Node.js는 Mirage의 서버 사이드 렌더링 지원을 통해)</td>\n<td>✅</td>\n</tr>\n<tr>\n<td>Browser</td>\n<td>✅</td>\n<td>⛔</td>\n<td>✅</td>\n<td>⛔ (프록시 서버를 통해 간접적으로 사용 가능)</td>\n</tr>\n</tbody>\n</table>\n</li>\n</ol>\n<h3><strong>MSW만의 특징</strong></h3>\n<p>MSW(Mock Service Worker)를 다른 mocking 도구들과 비교하여 채택한 주요 이유는 다음과 같아요.</p>\n<ul>\n<li>\n<p><strong>실제 네트워크 환경과의 유사성</strong></p>\n<ul>\n<li>MSW는 서비스 워커를 사용하여 실제 네트워크 요청을 가로채고 모의 응답을 제공해요. 이 접근 방식은 개발자가 실제 백엔드와 통신하는 것처럼 코드를 작성할 수 있게 하며, 나중에 실제 API로의 전환을 매끄럽게 해줘요. 다른 도구들이 라이브러리 레벨에서 모의를 제공하는 것과는 대조적으로, MSW는 네트워크 레벨에서 작동하므로 개발 경험이 더욱 실제 서버와 유시헤요.</li>\n</ul>\n</li>\n<li>\n<p><strong>광범위한 테스트 및 개발 환경 지원</strong></p>\n<ul>\n<li>MSW는 브라우저 뿐만 아니라 Node.js 환경에서도 작동해요. 또한 Jest와 같은 단위 테스트 프레임워크뿐만 아니라 Cypress, Storybook과 같은 통합 테스트 및 UI 컴포넌트 테스트 환경에서도 사용할 수 있어요. 이는 하나의 모의 설정을 통해 여러 테스팅 환경과 개발 환경에서 일관된 API mocking을 가능하게 도와줍니다.</li>\n</ul>\n</li>\n</ul>\n<h2>초기 세팅을 해보아요.</h2>\n<p>우선 사용자 데이터를 불러오는 간단한 API를 MSW를 사용해 연동해볼게요.</p>\n<h3><strong>1. 핸들러 작성하기</strong></h3>\n<p>먼저, API 요청을 가로챌 핸들러를 작성해야 합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">// handlers.ts</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> http<span class=\"token punctuation\">,</span> HttpResponse<span class=\"token punctuation\">,</span> delay <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"msw\"</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> handlers <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n  http<span class=\"token punctuation\">.</span><span class=\"token generic-function\"><span class=\"token function\">get</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>GetUserParams<span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> UserDto<span class=\"token punctuation\">,</span> <span class=\"token string\">\"/user/:userId\"</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span>\n    <span class=\"token string\">\"/user/:userId\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> params <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> userId <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> params\n\n      <span class=\"token keyword\">await</span> <span class=\"token function\">delay</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">)</span>\n\n      <span class=\"token keyword\">return</span> HttpResponse<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        id<span class=\"token operator\">:</span> userId<span class=\"token punctuation\">,</span>\n        nickName<span class=\"token operator\">:</span> <span class=\"token string\">\"곰곰곰\"</span><span class=\"token punctuation\">,</span>\n        birthDay<span class=\"token operator\">:</span> <span class=\"token string\">\"2000-01-01\"</span><span class=\"token punctuation\">,</span>\n        anniversaryDay<span class=\"token operator\">:</span> <span class=\"token string\">\"2023-12-16\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">]</span></code></pre></div>\n<blockquote>\n<p>HttpResponse 대신 new Response(..) 를 사용할 수도 있지만, HttpResponse가 1) json(),formData() 같은 유용한 메서드를 지원해주고 2) set-cookie를 설정할 수도 있어서 HttpResponse를 사용했어요.</p>\n</blockquote>\n<h3><strong>2. 브라우저 환경과 통합하기</strong></h3>\n<p>MSW를 웹 애플리케이션과 통합하기 위해서는 몇 가지 단계를 더 거쳐야 해요.</p>\n<ol>\n<li>\n<p><strong>Worker script 설치</strong></p>\n<p>아래 명령어를 실행합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\">npx msw init <span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>public <span class=\"token operator\">--</span>save</code></pre></div>\n</li>\n<li>\n<p><strong>Worker 설정</strong></p>\n<p>MSW Worker를 설정하고 핸들러를 등록합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">// browser.ts</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> setupWorker <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"msw/browser\"</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> handlers <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"./handlers\"</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> worker <span class=\"token operator\">=</span> <span class=\"token function\">setupWorker</span><span class=\"token punctuation\">(</span><span class=\"token operator\">...</span>handlers<span class=\"token punctuation\">)</span></code></pre></div>\n</li>\n<li>\n<p><strong>Worker 등록 및 실행</strong></p>\n<p>개발 환경에서만 MSW를 활성화하기 위해 조건을 설정하고, 애플리케이션 실행 전에 Worker를 등록합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">// msw.ts</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">enableMocking</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">NODE_ENV</span> <span class=\"token operator\">!==</span> <span class=\"token string\">\"development\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n   <span class=\"token keyword\">return</span>\n <span class=\"token punctuation\">}</span>\n\n <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> worker <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">import</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"./mocks/browser\"</span><span class=\"token punctuation\">)</span>\n\n <span class=\"token keyword\">return</span> worker<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// index.tsx</span>\n<span class=\"token keyword\">const</span> root <span class=\"token operator\">=</span> ReactDOM<span class=\"token punctuation\">.</span><span class=\"token function\">createRoot</span><span class=\"token punctuation\">(</span>document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"root\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">enableMocking</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n root\n   <span class=\"token punctuation\">.</span>render\n   <span class=\"token comment\">// 애플리케이션 컴포넌트</span>\n   <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n</li>\n</ol>\n<h3><strong>3. 콘솔에서 확인하기</strong></h3>\n<p>애플리케이션을 실행한 후, 개발자 도구의 콘솔에서 MSW가 정상적으로 작동하는지 확인합니다.</p>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/team-blog/static/fd20d6ff228922b2d308dcfea2bf5969/b842e/console-1-image.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 34.11764705882353%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsTAAALEwEAmpwYAAABEklEQVR42l1QSXLEIAz0a7ywCrEZjPEy9rgqlxzz/59EnkkOSZcohKRuITXXde37fhzH8oN1zN6toBEEF0JwKcV9cc4YG/6iyTmXUhAxxlBr9d47ayGMxt0uoncuUMQYVEqRAmm8hUizIcL5eCBATtOUE9UqrQ0BgI5WVitKaoMWnacQeYCWKujZuBDrecG4aD1KfTMkGOHHVxEC/QJRgWHouPXMepmrTEWmWcSpGQYW6gdOhw4RyHw0IZrt1GU1Mdllp6CeN1hPlWfYnjBV4YIIiRo0fdel7XO+vlJ8aJLnnIYZhGCSNnX7ZIymNZZpwwFpiX3bEqvve+o8+LHk+oypuqmknInftd0/vAht90t74xtXy1I3R7CCdQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='console 1 image' title='' src='/team-blog/static/fd20d6ff228922b2d308dcfea2bf5969/ca1dc/console-1-image.png' srcset='/team-blog/static/fd20d6ff228922b2d308dcfea2bf5969/e7570/console-1-image.png 170w,\n/team-blog/static/fd20d6ff228922b2d308dcfea2bf5969/f46e7/console-1-image.png 340w,\n/team-blog/static/fd20d6ff228922b2d308dcfea2bf5969/ca1dc/console-1-image.png 680w,\n/team-blog/static/fd20d6ff228922b2d308dcfea2bf5969/02d09/console-1-image.png 1020w,\n/team-blog/static/fd20d6ff228922b2d308dcfea2bf5969/b842e/console-1-image.png 1142w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<p>잘 작동하네요! 😮😮</p>\n<h3><strong>4. Mocking하지 않은 API 처리하기</strong></h3>\n<p>그런데 콘솔에는 많은 경고가 존재하고 있었어요.</p>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/team-blog/static/eb41f5a81a4b6bb43096d283176cf036/2d324/console-2-image.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 15.88235294117647%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAn0lEQVR42jWN3Q6CIABGfRhb5lQycUNLpYIU5EdQ1Lbe/zmii7azc3e+L+A4tqpwGi66mOVlnaD3ZkqPm6ARuRoAJ8n4SkWf9fe4rcKuDvH14AlIF5kRaAaMKKyEm0XOoFmV+1yvBm22kiwfaepjRhLfywFofvZz/SMOOM0+b+IsXne9LEzyWqtOiUaLRonbpLBgiOKI4tPfP/zlsz1+AeEwLts6Mx/OAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='console 2 image' title='' src='/team-blog/static/eb41f5a81a4b6bb43096d283176cf036/ca1dc/console-2-image.png' srcset='/team-blog/static/eb41f5a81a4b6bb43096d283176cf036/e7570/console-2-image.png 170w,\n/team-blog/static/eb41f5a81a4b6bb43096d283176cf036/f46e7/console-2-image.png 340w,\n/team-blog/static/eb41f5a81a4b6bb43096d283176cf036/ca1dc/console-2-image.png 680w,\n/team-blog/static/eb41f5a81a4b6bb43096d283176cf036/02d09/console-2-image.png 1020w,\n/team-blog/static/eb41f5a81a4b6bb43096d283176cf036/2d324/console-2-image.png 1306w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<p>이를 알아본 결과, MSW는 정의되지 않은 API 요청을 모두 캐치해 경고를 출력한다고 해요.</p>\n<div align='center'>\n    <span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/team-blog/static/e9acb4f8772e23aa561b6aede7bb84d0/ca756/console-3-image.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 53.529411764705884%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAABKUlEQVR42nWRSY6DQAxFuQMEmmJo5hkWURiiIHH/W+VRbkrJov/Csl22v/3Ler1ey7Ks67rv+/P5fDwenufdNBzHuV3Ad13X+4bVNM0wDH3fY8dxJEyS5FcjTdMsyxKNsiyjKKLhR+OvWSlVFEWe51KBpUcydV1XVYXDiK7rgiCwbRt+2ehsbtuWUtOAJUMPKxQahPjMZRariaWSKRZ1xMymDj+O4+CC0gi+IRnsybxtG5rd7/d5no/jYCS7fd7m/oOzGZ24B+ZPPeGfpon1wjCUpBHJzAWWKEwpDcS+7/OMsKIWT2K52YRGdotPQmFuoM2sylXySdj8gujCLobfghOpCfwLZNlC2ETkRgMH5aEVzag8bxbdzUn4vEEitPILOAyCRpYnVEq9AYLkUnKTmJuHAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='console 3 image' title='' src='/team-blog/static/e9acb4f8772e23aa561b6aede7bb84d0/ca1dc/console-3-image.png' srcset='/team-blog/static/e9acb4f8772e23aa561b6aede7bb84d0/e7570/console-3-image.png 170w,\n/team-blog/static/e9acb4f8772e23aa561b6aede7bb84d0/f46e7/console-3-image.png 340w,\n/team-blog/static/e9acb4f8772e23aa561b6aede7bb84d0/ca1dc/console-3-image.png 680w,\n/team-blog/static/e9acb4f8772e23aa561b6aede7bb84d0/02d09/console-3-image.png 1020w,\n/team-blog/static/e9acb4f8772e23aa561b6aede7bb84d0/ca756/console-3-image.png 1296w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n</div>\n<p>따라서 onUnhandledRequest 옵션을 bypass로 설정하여 정의되지 않은 API 요청은 무시하도록 설정했어요.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\">worker<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> onUnhandledRequest<span class=\"token operator\">:</span> <span class=\"token string\">\"bypass\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2>폴더 구조를 잡아봅시다.</h2>\n<p>간단하게 테스트해 본 결과, msw도입을 위해 필요한 파일들은 크게 3가지 종류로 나눌 수 있었어요.</p>\n<ol>\n<li>API 핸들러</li>\n<li>Mock 데이터</li>\n<li>브라우저 환경에서 실행할 수 있게 도와주는 Worker함수</li>\n</ol>\n<p>따라서 각 파일들을 어떤 디렉터리에 위치시킬지 생각해보았어요.</p>\n<p><strong>방법 1: API 경로 기반 구조</strong></p>\n<p>첫번째로 고려한 방식은 API 주소를 기준으로 폴더를 구성하는 방식이에요.</p>\n<p>예를 들어 <code class=\"language-text\">http://localhost/test/verification</code>이라는 API를 Mocking한다고 했을 때, 파일구조는 아래와 같이 작성됩니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">src\n├── __mocks__/\n│   ├── localhost/\n│   │   └── test/\n│   │       └── verification\n│   ├── handlers.ts\n│   └── browser.ts</code></pre></div>\n<p><strong>장점은 다음과 같아요.</strong></p>\n<ul>\n<li><strong>직관적인 경로:</strong> API 경로를 기반으로 하는 구조는 파일 시스템에서 해당 API를 쉽게 찾을 수 있게 해줍니다. 이는 특히 큰 프로젝트에서 API를 빠르게 찾아 수정해야 할 때 유용해요.</li>\n<li><strong>변경 관리 용이:</strong> 특정 API에 대한 변경 사항이 있을 때, 관련 파일을 찾아 수정하기가 간편합니다.</li>\n</ul>\n<p><strong>단점은 다음과 같아요.</strong></p>\n<ul>\n<li><strong>중복된 구조:</strong> 여러 API가 비슷한 데이터 구조를 공유할 경우, 코드와 mock 데이터의 중복이 발생할 수 있습니다.</li>\n<li><strong>스케일링 문제:</strong> 프로젝트 규모가 커지면 폴더 구조가 깊어지고 복잡해질 수 있습니다.</li>\n</ul>\n<p><strong>방법 2: Mock 데이터 중심 구조</strong></p>\n<p>두번째로 고려해 본 방식은 Mock 데이터만 별도로 관리하고 핸들러는 한 곳에 모으는 방식입니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">src\n├── server/\n│   ├── __mocks__/\n│   │   └── userList.ts/\n│   ├── handlers.ts\n│   └── browser.ts</code></pre></div>\n<p><strong>장점은 다음과 같아요.</strong></p>\n<ul>\n<li><strong>데이터 중심:</strong> 공통된 데이터 구조를 사용하는 API들이 많은 경우, mock 데이터를 중앙에서 관리함으로써 중복을 줄일 수 있습니다.</li>\n<li><strong>유연성:</strong> 데이터 변경이 필요할 때 한 곳에서 관리하기 때문에, 데이터의 일관성을 유지하기가 용이합니다.</li>\n</ul>\n<p><strong>단점은 다음과 같아요.</strong></p>\n<ul>\n<li><strong>핸들러 관리:</strong> 모든 핸들러를 한 곳에 모으게 되면, 파일이 방대해지고 관리가 어려워질 수 있습니다.</li>\n<li><strong>데이터와 핸들러의 분리:</strong> 데이터와 핸들러가 분리되어 있어, 관련 핸들러와 데이터 사이의 연결을 파악하기 어려울 수 있습니다.</li>\n</ul>\n<p><strong>방법 3: 도메인별 구조</strong></p>\n<p>세번째로 고려한 방식은 도메인별로 핸들러와 데이터를 모아두는 방식이에요.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">src\n├── mocks/\n│   ├── domain/\n│   │   └── album/\n│   │       ├── data.ts\n│   │       └── handlers.ts\n│   ├── handlers.ts\n│   └── browser.ts</code></pre></div>\n<p><strong>장점은 다음과 같아요.</strong></p>\n<ul>\n<li><strong>도메인 중심:</strong> 서비스의 기능별로 구분되어 있어, 관련 기능을 개발할 때 모든 관련 파일을 쉽게 찾을 수 있습니다.</li>\n<li><strong>유지보수 용이:</strong> 각 도메인별로 핸들러와 데이터를 분리함으로써, 유지보수가 용이합니다. 특정 기능에 문제가 생겼을 때, 해당 도메인의 폴더만 확인하면 됩니다.</li>\n<li><strong>확장성:</strong> 새로운 기능이나 도메인이 추가될 때, 새로운 폴더를 만들어 그 안에 모든 관련 파일을 배치함으로써 확장성이 높습니다.</li>\n</ul>\n<p><strong>단점은 다음과 같아요.</strong></p>\n<ul>\n<li><strong>공통 데이터 관리:</strong> 여러 도메인에서 공통적으로 사용되는 데이터가 있을 경우, 이를 어떻게 관리할지 고민이 필요합니다.</li>\n<li><strong>API 간 데이터 공유의 어려움:</strong> 특정 도메인에서만 사용되는 데이터가 아닌, 전역적으로 사용되는 데이터의 경우, 어느 도메인에 속해야 할지 결정하기 어려울 수 있습니다.</li>\n</ul>\n<p><strong>그로잉은요?</strong></p>\n<p>그로잉 서비스는 각 기능별로 구분된 도메인이 명확하기 때문에, 3번 방식이 가장 적합하다고 판단했어요.</p>\n<p>그리고 기존에 외부 라이브러리는 libs폴더에 정의해두고 사용했지만, msw 관련 파일은 mocks폴더에 전부 모아두기로 했어요. 빌드시 필요없는 코드와 파일들을 한 곳에 몰아넣기 위함이에요.</p>\n<p>또한 3번 방식처럼 도메인별 핸들러 함수를 한 파일에 전부 정의해두는 것보다는 분리한 후 index 파일에서 취합해서 내보내기로 했어요. API별 데이터들과 params, 200일때, 400일때 케이스들을 한 파일에 모두 작성하면 코드의 길이가 너무 길어져서 가독성을 해칠 것이라고 판단했기 때문이에요.</p>\n<p>따라서 아래와 같이 폴더 구조를 정할 수 있었어요.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">src\n├── mocks/\n│   ├── user/\n│   │   ├── index.ts\n│   │   ├── getUserHandler.ts\n│   │   └── anotherHandler.ts\n│   ├── handlers.ts // 도메인별 핸들러 함수를 모두 취합하는 곳이에요.\n│   ├── browser.ts // worker를 정의해 둔 파일이에요.\n│   └── msw.ts // enableMocking() 함수를 정의해 둔 파일이에요.</code></pre></div>\n<p>아래는 예시입니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">// mocks/user/getUserHandler.ts</span>\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">Params</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  userId<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> data<span class=\"token operator\">:</span> UserDto <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  id<span class=\"token operator\">:</span> <span class=\"token string\">\"1\"</span><span class=\"token punctuation\">,</span>\n  nickName<span class=\"token operator\">:</span> <span class=\"token string\">\"곰곰곰\"</span><span class=\"token punctuation\">,</span>\n  birthDay<span class=\"token operator\">:</span> <span class=\"token string\">\"2000-01-01\"</span><span class=\"token punctuation\">,</span>\n  anniversaryDay<span class=\"token operator\">:</span> <span class=\"token string\">\"2023-12-16\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">getUserHandler</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  http<span class=\"token punctuation\">.</span><span class=\"token generic-function\"><span class=\"token function\">get</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>Params<span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> UserDto<span class=\"token punctuation\">,</span> <span class=\"token string\">\"/user/:userId\"</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span>\n    <span class=\"token string\">\"/user/:userId\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> params <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> userId <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> params\n\n      <span class=\"token keyword\">await</span> <span class=\"token function\">delay</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">)</span>\n\n      <span class=\"token keyword\">return</span> HttpResponse<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// mocks/user/index.ts</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> getUserHandler <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"./getUserHandler\"</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> anotherHandler <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"./anotherHandler\"</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> UserHandlers <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>getUserHandler<span class=\"token punctuation\">,</span> anotherHandler<span class=\"token punctuation\">]</span></code></pre></div>\n<p>그러나 이 방식은 일부 도메인에는 적용할 수 없었어요.</p>\n<p>GET, POST, DELETE 하는 API 가 같은 데이터를 바라봐야 했기 때문이죠. 만약 기존 데이터를 DELETE 요청으로 지운 후에 GET 요청을 했을 때, 지운 데이터가 남아 있다면 테스트할 때 불편하다고 판단했어요.</p>\n<p>최최최최종.jpg</p>\n<p>따라서 데이터를 공유해야하는 API 들은 한 파일 안에 작성해두는 것으로 변경했어요.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">src\n├── mocks/\n│   ├── user/\n│   │   ├── getUserHandler.ts // 데이터를 공유할 필요없는 API\n│   │   ├── ...\n│   │   └── index.ts\n│   ├── chat/\n│   │   ├── data/\n│   │   │   ├── chatData.ts // 공유할 데이터\n│   │   │   └── image.png\n│   │   ├── chatHandler.ts // 공유할 데이터들을 사용하는 API들\n│   │   ├── chatQuestionHandler.ts\n│   │   └── index.ts\n│   ├── handlers.ts\n│   └── browser.ts</code></pre></div>\n<h2>에러 응답 목업은 어떻게 하지? 🤔</h2>\n<p>애플리케이션은 완벽할 수 없습니다. 네트워크 에러나 우리가 미처 처리하지 못한 예외 등으로 인해 생각한 대로 동작하지 않기도 해요. 그렇기 때문에 성공적인 응답만 mocking하는 것으로는 부족합니다. 이번 절에서는 에러 응답에 대한 모킹 방법에 대해 알아볼게요.</p>\n<h3>MSW <strong>공식 문서 살펴보기</strong></h3>\n<p>MSW의 공식 문서에서 다음과 같은 에러 응답 목업 방식에 대해 찾을 수 있었어요.</p>\n<ul>\n<li>\n<p>status code 설정하기</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> handlers <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\nhttp<span class=\"token punctuation\">.</span><span class=\"token function\">delete</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/posts/:id\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> params <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> id <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> params\n  <span class=\"token keyword\">const</span> deletedPost <span class=\"token operator\">=</span> allPosts<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>deletedPost<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HttpResponse</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">status</span><span class=\"token operator\">:</span> <span class=\"token number\">404</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  allPosts<span class=\"token punctuation\">.</span><span class=\"token function\">delete</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">return</span> HttpResponse<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span>deletedPost<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">]</span></code></pre></div>\n<p>→ 조건에 따라 에러를 나타내는 status를 함께 반환하는 방식이에요.</p>\n</li>\n<li>\n<p>Network Error</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> http<span class=\"token punctuation\">,</span> HttpResponse <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"msw\"</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> handlers <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\nhttp<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/resource\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> HttpResponse<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">]</span></code></pre></div>\n<p>→ 네트워크 에러의 경우 위와 같이 HttpResponse.error()를 반환해요.</p>\n</li>\n<li>\n<p>dynamic mock scenarios</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> http<span class=\"token punctuation\">,</span> HttpResponse <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"msw\"</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> scenarios <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n<span class=\"token literal-property property\">success</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n  http<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/user\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> HttpResponse<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">\"minju\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token literal-property property\">error</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n  http<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/user\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HttpResponse</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">status</span><span class=\"token operator\">:</span> <span class=\"token number\">500</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>→ 응답에 성공하는 경우와, 에러인 경우를 시나리오로 작성할 수 있어요. url 뒤에 <code class=\"language-text\">?scenario=error</code> 을 붙이면 오류 응답을 반환하는 경우에 어떻게 작동하는지 런타임에서 확인할 수 있어요.</p>\n</li>\n</ul>\n<h3>그로잉에서 선택한 에러 목업</h3>\n<p>저희는 런타임에서 여러 기능들의 성공과 실패의 조합에 따라 테스트를 할 수 있는 방식이 필요했어요. msw에서 제공해주는 dynamic mock scenarios를 사용해 이를 구현하려면 url이 바뀌여야 하고, 한 페이지에 있는 여러 기능에 대해 각 시나리오를 식별하도록 코드를 추가로 작성해야 합니다. 그래서 저희는 status code를 런타임에 다르게 설정하는 방식을 사용하기로 했고, 여러 조합을 편하게 테스트할 수 있게 도와주는 툴바를 제작하기로 했어요.</p>\n<h2>툴바를 만들자!</h2>\n<h3>정의된 핸들러 리스트 받아오기</h3>\n<p>툴바 구현을 위해 먼저 정의해 둔 핸들러 리스트 정보들을 가져올 수 있는 지가 가장 중요했어요. 따라서 해당 정보를 받아올 수 있는지 확인하는 작업을 먼저 진행했어요.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">// App.ts</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> handlers <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"mocks/handlers\"</span>\n\n<span class=\"token comment\">// 각 핸들러의 경로와 메소드 정보를 콘솔에 출력</span>\nhandlers<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span>handler <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> path<span class=\"token punctuation\">,</span> method <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> handler<span class=\"token punctuation\">.</span>info <span class=\"token comment\">// 핸들러의 정보에서 경로와 메소드 추출</span>\n  <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> path<span class=\"token punctuation\">,</span> method <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>다행히도 MSW 핸들러에서 제공하는 정보를 활용하여, 간단한 코드 몇 줄로 원하는 핸들러 정보를 추출할 수 있었어요.</p>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 591px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/team-blog/static/4806ff3d1e408562695dfde240214c09/c1f10/handler-list-image.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 18.23529411764706%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAsElEQVR42k2PWY7EMAhEcxawxxte4i2200nPdv8zDfkbhNCTUBXFFkNQ1mE5RO64V2yTW5SOuWFfxlEiskQiN6M1Isp/teV91z7AuPE4oU1Yn3B+MWM/GUQdct6Ct+OyPsSUjA9srbUSiFstxYTEGpysf+HrG66fh8cF9y8DzLetLdaqSvtYbyJS2ihjpXNbjEE5grY4OXJyPtjPh8sB7JX7M/sSz7bxXyyO3suQZB1/sycr4YzXy1kAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='handler list image' title='' src='/team-blog/static/4806ff3d1e408562695dfde240214c09/c1f10/handler-list-image.png' srcset='/team-blog/static/4806ff3d1e408562695dfde240214c09/e7570/handler-list-image.png 170w,\n/team-blog/static/4806ff3d1e408562695dfde240214c09/f46e7/handler-list-image.png 340w,\n/team-blog/static/4806ff3d1e408562695dfde240214c09/c1f10/handler-list-image.png 591w' sizes='(max-width: 591px) 100vw, 591px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n이렇게 콘솔에 출력된 정보를 바탕으로, 핸들러 정보를 관리하는 클래스나 객체를 구성하여 필요할 때마다 활용하면 될 것 같네요!</p>\n<h3>UI</h3>\n<p>툴바의 UI는 피그마를 사용하여 디자인했습니다. 툴바에 포함될 주요 기능은 다음과 같아요.</p>\n<ol>\n<li><strong>API 경로 검색</strong>: 사용자가 특정 API 경로를 검색하여 해당하는 핸들러를 찾을 수 있습니다.</li>\n<li><strong>상태 코드 변경</strong>: 성공 또는 에러 상태 코드를 동적으로 변경할 수 있어, 다양한 응답 시나리오를 시뮬레이션할 수 있습니다.</li>\n<li><strong>응답 지연 설정</strong>: API 응답의 지연 시간을 설정하여 네트워크 지연 테스트를 할 수 있습니다.</li>\n</ol>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 662px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/team-blog/static/430923936cda4ac400a16718b871dc18/46b67/ui-image.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 74.70588235294117%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAAsTAAALEwEAmpwYAAABtklEQVR42qWRS0sCURTH55NUIMYsFHxBvh84bcRRZ3J84Kih066CKIw030gbN0kk+gkkQUEGdDEuxC/Wvzshow216Le43Hv+53/uuedSpwSj0WgwGI4JR4QTAuLGL1FfpYLBYL1WB9Vqtd1udzod7FutVqVSsVgsfr+/8dyoEbrdLhKgNptNqFarlWKYc3kmL5fLxWKxWq3W67WiKJvNZjKZQA6Hw7OP2Xw+l2VZISBhu91Op1ObzUZ5vV6O51iWjcfjsViMJUSjUY7jYA4FQ0+PNUm6EkUxn8+n02mkMQwTiUTsdjvl8/kQ4nn+QgOOqVQKtfGo+7uHcqmcy+VKpVK/3+/1emr/32bk4R5eA46CIEBGX4V8IZlMJhIJ3AEbHvxCODTvSmCDIHkz8/b6fnN9m81mi8WiJEmXBGz2zOhWIGhv9ng8iHME+Mfj8WAwGI1Gw+Fwz4xVJKBJrRlxdSJY1Ymq4/ytba15F08SUCiTyfw9sAOzdiL/NuMzkIef4DTgiPbwz263W1dVS1OBQABjRKqgAUe8yuFwoLSuiiBUymw2u1yusx84nU6apk0mk66KIE3Tn5znJn09RpWyAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='ui image' title='' src='/team-blog/static/430923936cda4ac400a16718b871dc18/46b67/ui-image.png' srcset='/team-blog/static/430923936cda4ac400a16718b871dc18/e7570/ui-image.png 170w,\n/team-blog/static/430923936cda4ac400a16718b871dc18/f46e7/ui-image.png 340w,\n/team-blog/static/430923936cda4ac400a16718b871dc18/46b67/ui-image.png 662w' sizes='(max-width: 662px) 100vw, 662px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<h3><strong>핸들러 동적 변경 고려사항</strong></h3>\n<p>상태 코드나 응답 지연 시간을 변경하려면, 기존의 핸들러 코드를 동적으로 조절할 필요가 있었어요. 예를 들어, 성공 응답과 에러 응답을 다루는 두 가지 핸들러가 있다고 가정해 보겠습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">// mocks/user/getUserHandler.ts</span>\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">Params</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  userId<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> data<span class=\"token operator\">:</span> UserDto <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n\tid<span class=\"token operator\">:</span> <span class=\"token string\">'1'</span><span class=\"token punctuation\">,</span>\n\tnickName<span class=\"token operator\">:</span> <span class=\"token string\">'곰곰곰'</span><span class=\"token punctuation\">,</span>\n\tbirthDay<span class=\"token operator\">:</span> <span class=\"token string\">'2000-01-01'</span><span class=\"token punctuation\">,</span>\n\tanniversaryDay<span class=\"token operator\">:</span> <span class=\"token string\">'2023-12-16'</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// 성공 응답 핸들러</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">getUserSuccessHandler</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\thttp<span class=\"token punctuation\">.</span><span class=\"token generic-function\"><span class=\"token function\">get</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>Params<span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> UserDto<span class=\"token punctuation\">,</span> <span class=\"token string\">'/user/:userId'</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span>\n    <span class=\"token string\">'/user/:userId'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token keyword\">await</span> <span class=\"token function\">delay</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 1초 지연</span>\n\n      <span class=\"token keyword\">return</span> HttpResponse<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n\t      status<span class=\"token operator\">:</span> <span class=\"token number\">200</span><span class=\"token punctuation\">,</span>\n\t      statusText<span class=\"token operator\">:</span> <span class=\"token string\">'요청에 상공했습니다.'</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">getUserErrorHandler</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\thttp<span class=\"token punctuation\">.</span><span class=\"token generic-function\"><span class=\"token function\">get</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>Params<span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'/user/:userId'</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span>\n    <span class=\"token string\">'/user/:userId'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token keyword\">await</span> <span class=\"token function\">delay</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 0.5초 지연</span>\n\n      <span class=\"token keyword\">return</span> HttpResponse<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n\t      status<span class=\"token operator\">:</span> <span class=\"token number\">400</span><span class=\"token punctuation\">,</span>\n\t      statusText<span class=\"token operator\">:</span> <span class=\"token string\">'요청에 실패했습니다.'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>세 부분에서 변경이 일어나는 것을 알 수 있어요.</p>\n<ol>\n<li><strong>응답 타입</strong>: 성공과 실패 응답의 타입이 다를 수 있습니다.</li>\n<li><strong>지연 시간</strong>: <code class=\"language-text\">delay</code> 함수의 인자를 통해 응답 지연 시간을 설정합니다.</li>\n<li><strong>응답 데이터</strong>: <code class=\"language-text\">HttpResponse.json</code> 메소드의 인자로 전달되는 데이터입니다.</li>\n</ol>\n<p>따라서 이 요소들을 런타임에 동적으로 바꿔줄 수 있어야 했어요. 이를 하드코딩이 아닌 변수로 지정해두고 동적으로 바꿔주면 될 것 같아요.</p>\n<h3>해당하는 URL에 맞는 핸들러 찾는 법</h3>\n<p>그렇다면 검색한 API URL에 맞는 핸들러는 어떻게 찾을 수 있을까요?</p>\n<p>같은 URL에 대해 다른 HTTP 메소드(GET, POST, DELETE 등)를 사용하는 경우가 많기 때문에, 단순히 URL만으로 핸들러를 찾는 것은 충분하지 않았아요.</p>\n<p>이를 해결하기 위해 핸들러 정보를 저장할 때 URL 경로와 HTTP 메소드의 조합을 고유한 식별자로 사용하기로 결정했어요.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">interface</span> <span class=\"token class-name\">HandlerInfoList</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token punctuation\">[</span>path<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">[</span>method<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> HandlerInfo\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 481px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/team-blog/static/840531a3fe05d7281ef74656cbdb898f/213b2/url-search-image.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsTAAALEwEAmpwYAAABq0lEQVR42mWSS0sCYRSGvx8lbjRUsNHUvI2XuajjJcVFCdEuqDBDMqJA2gTWqDSamYm5CukPuBYE17lR3FhL0V7mwyh6Fof3u51z3jNDdnf3nqqtRqPxoDzU63VFUWq1GkRN5fkfzWaz1WrhWiAQIPd38mq++pp/fozHs9lsMpnMVKbTKeJyuVz9he4sFotMJkMYZpMXgoIoJJPJHRUqaEwkEvF4PPELbKZSqUgkYrVayX7m4PqieHp8ZrPZtlXsdrvT6XS5XG63G0unCk4dDgcEwzAGg8FkMlksFnJ0eKLIj7c3Jb/fHwqFRFEMBoOI4XBYkiQIQRCi0SjtJRaL8Tzv9XpZlkU6YjQadXqdfkOPlJsqP4JqFJFlud/vDwaDUqnU6/WGw+FoNEqn0wSNsV7W4/Yg05YKFbY10KiG4jDPcRw6oubxkFyeX729vjeVF/UGOpXQJyKdEwSe+Xw+DAKeYc1sNms0Gq1WC0FQVuRFjuPpMaBiew0q53K5crmMz57NZovFYqVSqVarGBD5cYjRW/6BTVQoFAr4bdrtdj6fh+1Op9PtdiVJ+gY/NxK8PBIHZAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='url search image' title='' src='/team-blog/static/840531a3fe05d7281ef74656cbdb898f/213b2/url-search-image.png' srcset='/team-blog/static/840531a3fe05d7281ef74656cbdb898f/e7570/url-search-image.png 170w,\n/team-blog/static/840531a3fe05d7281ef74656cbdb898f/f46e7/url-search-image.png 340w,\n/team-blog/static/840531a3fe05d7281ef74656cbdb898f/213b2/url-search-image.png 481w' sizes='(max-width: 481px) 100vw, 481px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<h3>HandlerInfoManager 구현과 활용</h3>\n<p>핸들러들을 저장하고 꺼내오고 delay 변수값들을 변경시켜주는 작업을 저희 그로잉 팀은 HandlerInfoManager 클래스를 제작하여 해결하였어요.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> handlers <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"mocks/handlers\"</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token constant\">DEFAULT_STATUS</span> <span class=\"token operator\">=</span> <span class=\"token number\">200</span>\n<span class=\"token keyword\">const</span> <span class=\"token constant\">DEFAULT_DELAY</span> <span class=\"token operator\">=</span> <span class=\"token number\">1000</span>\n\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">StatusType</span> <span class=\"token operator\">=</span> <span class=\"token number\">200</span> <span class=\"token operator\">|</span> <span class=\"token number\">400</span>\n\n<span class=\"token keyword\">interface</span> <span class=\"token class-name\">HandlerInfo</span> <span class=\"token punctuation\">{</span>\n  status<span class=\"token operator\">:</span> StatusType\n  delayTime<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">interface</span> <span class=\"token class-name\">HandlerInfoList</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token punctuation\">[</span>path<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">[</span>method<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> HandlerInfo\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">interface</span> <span class=\"token class-name\">HandlerInfoParams</span> <span class=\"token punctuation\">{</span>\n  path<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span>\n  method<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span>\n  code<span class=\"token operator\">:</span> StatusType\n  time<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">HandlerInfoManager</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">private</span> handlerInfos<span class=\"token operator\">:</span> HandlerInfoList <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// 핸들러 정보 초기화</span>\n  <span class=\"token keyword\">public</span> <span class=\"token function\">initHandlerInfo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token keyword\">void</span> <span class=\"token punctuation\">{</span>\n    handlers<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span>handler <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> path<span class=\"token punctuation\">,</span> method <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> handler<span class=\"token punctuation\">.</span>info\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setHandlerInfo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        path<span class=\"token operator\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        method<span class=\"token operator\">:</span> method<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        code<span class=\"token operator\">:</span> <span class=\"token number\">200</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 기본 상태 코드</span>\n        time<span class=\"token operator\">:</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 기본 지연 시간</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// 핸들러 정보 설정</span>\n  <span class=\"token keyword\">public</span> <span class=\"token function\">setHandlerInfo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> path<span class=\"token punctuation\">,</span> method<span class=\"token punctuation\">,</span> code<span class=\"token punctuation\">,</span> time <span class=\"token punctuation\">}</span><span class=\"token operator\">:</span> HandlerInfoParams<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token keyword\">void</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>handlerInfos<span class=\"token punctuation\">[</span>path<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>handlerInfos<span class=\"token punctuation\">[</span>path<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>handlerInfos<span class=\"token punctuation\">[</span>path<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>method<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> status<span class=\"token operator\">:</span> code<span class=\"token punctuation\">,</span> delayTime<span class=\"token operator\">:</span> time <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// 핸들러 리스트 조회</span>\n  <span class=\"token keyword\">public</span> <span class=\"token function\">getHandlerInfos</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> HandlerInfoList <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>handlerInfos\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// 특정 핸들러 정보 조회</span>\n  <span class=\"token keyword\">public</span> <span class=\"token function\">getHandlerInfo</span><span class=\"token punctuation\">(</span>path<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> method<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> HandlerInfo <span class=\"token operator\">|</span> <span class=\"token keyword\">undefined</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>handlerInfos<span class=\"token punctuation\">[</span>path<span class=\"token punctuation\">]</span><span class=\"token operator\">?.</span><span class=\"token punctuation\">[</span>method<span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> handlerInfoManager <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HandlerInfoManager</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>이렇게 <code class=\"language-text\">HandlerInfoManager</code>를 사용하면 핸들러의 상태 코드와 지연 시간을 런타임에 변경할 수 있으며, 툴바 UI에서 사용자의 입력에 따라 이러한 변경을 적용할 수 있습니다.</p>\n<h3>사용 예시</h3>\n<p>사용 예시는 다음과 같아요.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> handlerInfoManager <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"mocks/HandlerInfoManager\"</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> CoupleDto <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"models/couple\"</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> delay<span class=\"token punctuation\">,</span> http<span class=\"token punctuation\">,</span> HttpResponse <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"msw\"</span>\n\n<span class=\"token keyword\">interface</span> <span class=\"token class-name\">Params</span> <span class=\"token punctuation\">{</span>\n  coupleId<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> data<span class=\"token operator\">:</span> CoupleDto <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  coupleId<span class=\"token operator\">:</span> <span class=\"token string\">\"1\"</span><span class=\"token punctuation\">,</span>\n  myName<span class=\"token operator\">:</span> <span class=\"token string\">\"연주\"</span><span class=\"token punctuation\">,</span>\n  partnerName<span class=\"token operator\">:</span> <span class=\"token string\">\"민지\"</span><span class=\"token punctuation\">,</span>\n  dayCount<span class=\"token operator\">:</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span>\n  petId<span class=\"token operator\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> getCoupleHandler <span class=\"token operator\">=</span> http<span class=\"token punctuation\">.</span><span class=\"token generic-function\"><span class=\"token function\">get</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>Params<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> CoupleDto <span class=\"token operator\">|</span> <span class=\"token keyword\">null</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span>\n  <span class=\"token string\">\"/couples/:coupleId\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> responseList <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token number\">200</span><span class=\"token operator\">:</span> HttpResponse<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n        status<span class=\"token operator\">:</span> <span class=\"token number\">200</span><span class=\"token punctuation\">,</span>\n        statusText<span class=\"token operator\">:</span> <span class=\"token string\">\"success\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token number\">400</span><span class=\"token operator\">:</span> HttpResponse<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n        status<span class=\"token operator\">:</span> <span class=\"token number\">400</span><span class=\"token punctuation\">,</span>\n        statusText<span class=\"token operator\">:</span> <span class=\"token string\">\"fail\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">const</span> handler <span class=\"token operator\">=</span> handlerInfoManager<span class=\"token punctuation\">.</span><span class=\"token function\">getHandlerInfo</span><span class=\"token punctuation\">(</span>\n      <span class=\"token string\">\"/couples/:coupleId\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string\">\"GET\"</span>\n    <span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">const</span> status <span class=\"token operator\">=</span> handler<span class=\"token operator\">?.</span>status <span class=\"token operator\">||</span> <span class=\"token number\">200</span>\n    <span class=\"token keyword\">const</span> delayTime <span class=\"token operator\">=</span> handler<span class=\"token operator\">?.</span>delayTime <span class=\"token operator\">||</span> <span class=\"token number\">0</span>\n\n    <span class=\"token keyword\">await</span> <span class=\"token function\">delay</span><span class=\"token punctuation\">(</span>delayTime<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> responseList<span class=\"token punctuation\">[</span>status<span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">handleClick</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>path<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> method<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  handlerInfoManager<span class=\"token punctuation\">.</span><span class=\"token function\">setHandlerInfo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> path<span class=\"token punctuation\">,</span> method<span class=\"token punctuation\">,</span> code<span class=\"token operator\">:</span> <span class=\"token number\">400</span><span class=\"token punctuation\">,</span> time<span class=\"token operator\">:</span> <span class=\"token number\">3000</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3>추상화를 해보자</h3>\n<p>모든 API 핸들러에서 반복적으로 나타나는 패턴들은 무엇이 있을까요?</p>\n<p>다음 코드가 반복해서 작성되어야 했어요. 이를 추상화하여 코드 중복을 줄여볼게요.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">const</span> handler <span class=\"token operator\">=</span> handlerInfoManager<span class=\"token punctuation\">.</span><span class=\"token function\">getHandlerInfo</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/couples/:coupleId\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"GET\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">const</span> status <span class=\"token operator\">=</span> handler<span class=\"token operator\">?.</span>status <span class=\"token operator\">||</span> <span class=\"token number\">200</span>\n<span class=\"token keyword\">const</span> delayTime <span class=\"token operator\">=</span> handler<span class=\"token operator\">?.</span>delayTime <span class=\"token operator\">||</span> <span class=\"token number\">0</span>\n\n<span class=\"token keyword\">await</span> <span class=\"token function\">delay</span><span class=\"token punctuation\">(</span>delayTime<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">return</span> responseList<span class=\"token punctuation\">[</span>status<span class=\"token punctuation\">]</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> handlerInfoManager <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"mocks/HandlerInfoManager\"</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> delay<span class=\"token punctuation\">,</span> http <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"msw\"</span>\n\n<span class=\"token comment\">// 상태 코드별 응답 데이터를 매핑하는 객체 타입을 정의합니다.</span>\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">ResponseData<span class=\"token operator\">&lt;</span>TResponse<span class=\"token operator\">></span></span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token punctuation\">[</span>key<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> TResponse <span class=\"token operator\">|</span> <span class=\"token keyword\">null</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// API 요청 처리 함수 타입을 정의합니다.</span>\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">RequestHandler<span class=\"token operator\">&lt;</span>TParams<span class=\"token punctuation\">,</span> TResponse<span class=\"token operator\">></span></span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>\n  params<span class=\"token operator\">:</span> TParams\n<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> ResponseData<span class=\"token operator\">&lt;</span>TResponse<span class=\"token operator\">></span>\n\n<span class=\"token comment\">// 범용 API 핸들러 생성 함수를 정의합니다.</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> createApiHandler <span class=\"token operator\">=</span> <span class=\"token operator\">&lt;</span>TParams<span class=\"token punctuation\">,</span> TResponse<span class=\"token operator\">></span><span class=\"token punctuation\">(</span>\n  path<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span>\n  method<span class=\"token operator\">:</span> <span class=\"token keyword\">keyof</span> <span class=\"token keyword\">typeof</span> http<span class=\"token punctuation\">,</span>\n  handleRequest<span class=\"token operator\">:</span> RequestHandler<span class=\"token operator\">&lt;</span>TParams<span class=\"token punctuation\">,</span> TResponse<span class=\"token operator\">></span>\n<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> http<span class=\"token punctuation\">[</span>method<span class=\"token punctuation\">]</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> req <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> params <span class=\"token operator\">=</span> req<span class=\"token punctuation\">.</span>params <span class=\"token keyword\">as</span> TParams\n    <span class=\"token keyword\">const</span> handler <span class=\"token operator\">=</span> handlerInfoManager<span class=\"token punctuation\">.</span><span class=\"token function\">getHandlerInfo</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">,</span> method<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">const</span> delayTime <span class=\"token operator\">=</span> handler<span class=\"token operator\">?.</span>delayTime <span class=\"token operator\">||</span> <span class=\"token number\">0</span>\n    <span class=\"token keyword\">const</span> responseStatus <span class=\"token operator\">=</span> handler<span class=\"token operator\">?.</span>status <span class=\"token operator\">||</span> <span class=\"token number\">200</span>\n\n    <span class=\"token keyword\">await</span> <span class=\"token function\">delay</span><span class=\"token punctuation\">(</span>delayTime<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">const</span> responseData <span class=\"token operator\">=</span> <span class=\"token function\">handleRequest</span><span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> responseData<span class=\"token punctuation\">[</span>responseStatus<span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이 추상화를 통해 아래처럼 간편하게 개별 핸들러들을 구현할 수 있게 되었어요. 각 API 핸들러마다 상태 코드와 지연 시간을 처리하는 로직을 반복해서 작성할 필요가 없어진거죠.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">// 사용 예시: 커플 정보 조회 API 핸들러</span>\n<span class=\"token keyword\">interface</span> <span class=\"token class-name\">Params</span> <span class=\"token punctuation\">{</span>\n  coupleId<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> data<span class=\"token operator\">:</span> CoupleDto <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  coupleId<span class=\"token operator\">:</span> <span class=\"token string\">\"1\"</span><span class=\"token punctuation\">,</span>\n  myName<span class=\"token operator\">:</span> <span class=\"token string\">\"연주\"</span><span class=\"token punctuation\">,</span>\n  partnerName<span class=\"token operator\">:</span> <span class=\"token string\">\"민지\"</span><span class=\"token punctuation\">,</span>\n  dayCount<span class=\"token operator\">:</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span>\n  petId<span class=\"token operator\">:</span> <span class=\"token string\">\"1\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> getCoupleHandler <span class=\"token operator\">=</span> <span class=\"token generic-function\"><span class=\"token function\">createApiHandler</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>Params<span class=\"token punctuation\">,</span> CoupleDto <span class=\"token operator\">|</span> <span class=\"token keyword\">null</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span>\n  <span class=\"token string\">\"/couples/:coupleId\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"get\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 여기서는 단순화를 위해 바로 데이터를 반환하지만,</span>\n    <span class=\"token comment\">// 실제로는 params를 기반으로 데이터를 조회하거나 처리할 수 있습니다.</span>\n    <span class=\"token number\">200</span><span class=\"token operator\">:</span> data<span class=\"token punctuation\">,</span> <span class=\"token comment\">// 성공 응답</span>\n    <span class=\"token number\">400</span><span class=\"token operator\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 실패 응답</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<h2>그러나,,</h2>\n<p>처음에 생각한 기능들 외에 추가로 필요한 기능들이 있었어요. 처음에는 Path Parameter만 필요했었지만 Query Parameter가 필요한 경우도 있었어요.</p>\n<blockquote>\n<p>Parameter type</p>\n<ol>\n<li>Query parameters: <code class=\"language-text\">?a=1&amp;b=2</code>;</li>\n<li>Path parameters: <code class=\"language-text\">GET /user/:id</code>, where <code class=\"language-text\">id</code> is a path parameter.</li>\n</ol>\n</blockquote>\n<p>그리고 API 호출 성공 후에 로직을 처리할 콜백 함수가 필요했어요. DELETE 요청 후에 기존 data를 삭제하거나, PATCH 후에 수정하는 코드가 필요했기 때문이에요.</p>\n<p>이러한 추가 요구사항을 충족하기 위해 다음과 같이 <code class=\"language-text\">createApiHandler</code> 함수를 확장했어요.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">// ApiHandlerCreator.ts</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> DefaultBodyType<span class=\"token punctuation\">,</span> PathParams<span class=\"token punctuation\">,</span> delay<span class=\"token punctuation\">,</span> http<span class=\"token punctuation\">,</span> HttpResponse<span class=\"token punctuation\">,</span> StrictRequest <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'msw'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> handlerInfoManager <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./HandlerInfoManager'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// 응답 데이터 타입 정의: 상태 코드별로 응답 데이터를 매핑</span>\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">ResponseData<span class=\"token operator\">&lt;</span>TResponse<span class=\"token operator\">></span></span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token punctuation\">[</span>status<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> NullableResponse<span class=\"token operator\">&lt;</span>TResponse<span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// 요청 처리 핸들러 타입 정의: 경로 및 요청 매개변수를 받아 응답 데이터를 반환</span>\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">RequestHandler<span class=\"token operator\">&lt;</span>TParams<span class=\"token punctuation\">,</span> TRequest<span class=\"token punctuation\">,</span> TResponse<span class=\"token operator\">></span></span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>\n  params<span class=\"token operator\">:</span> TParams<span class=\"token punctuation\">,</span>\n  request<span class=\"token operator\">:</span> TRequest\n<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> ResponseData<span class=\"token operator\">&lt;</span>TResponse<span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// 요청 처리 후 실행할 콜백 함수 타입 정의</span>\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">AfterRequest<span class=\"token operator\">&lt;</span>TParams<span class=\"token punctuation\">,</span> TRequest<span class=\"token operator\">></span></span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>\n  params<span class=\"token operator\">:</span> TParams<span class=\"token punctuation\">,</span>\n  request<span class=\"token operator\">:</span> TRequest\n<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">void</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// 범용 API 핸들러 생성 함수</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> createApiHandler <span class=\"token operator\">=</span> <span class=\"token operator\">&lt;</span>\n  TParams <span class=\"token keyword\">extends</span> <span class=\"token class-name\">PathParams</span><span class=\"token punctuation\">,</span>\n  TRequest <span class=\"token keyword\">extends</span> <span class=\"token class-name\">DefaultBodyType</span><span class=\"token punctuation\">,</span>\n  TResponse <span class=\"token keyword\">extends</span> <span class=\"token class-name\">DefaultBodyType</span>\n<span class=\"token operator\">></span><span class=\"token punctuation\">(</span>\n  path<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n  method<span class=\"token operator\">:</span> <span class=\"token keyword\">keyof</span> <span class=\"token keyword\">typeof</span> http<span class=\"token punctuation\">;</span>\n  requestHandler<span class=\"token operator\">:</span> RequestHandler<span class=\"token operator\">&lt;</span>TParams<span class=\"token punctuation\">,</span> StrictRequest<span class=\"token operator\">&lt;</span>TRequest<span class=\"token operator\">></span><span class=\"token punctuation\">,</span> TResponse<span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\n  onSuccess<span class=\"token operator\">?</span><span class=\"token operator\">:</span> AfterRequest<span class=\"token operator\">&lt;</span>TParams<span class=\"token punctuation\">,</span> StrictRequest<span class=\"token operator\">&lt;</span>TRequest<span class=\"token operator\">>></span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> http<span class=\"token punctuation\">[</span>method<span class=\"token punctuation\">]</span><span class=\"token operator\">&lt;</span>TParams<span class=\"token punctuation\">,</span> TRequest<span class=\"token punctuation\">,</span> TResponse<span class=\"token operator\">></span><span class=\"token punctuation\">(</span>\n    path<span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> params<span class=\"token punctuation\">,</span> request <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// 요청 처리 함수를 호출하여 응답 데이터를 가져옴</span>\n      <span class=\"token keyword\">const</span> responseData <span class=\"token operator\">=</span> <span class=\"token function\">requestHandler</span><span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">,</span> request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token comment\">// 핸들러 정보(응답 지연 시간 및 상태 코드) 조회</span>\n      <span class=\"token keyword\">const</span> handlerInfo <span class=\"token operator\">=</span> handlerInfoManager<span class=\"token punctuation\">.</span><span class=\"token function\">getHandlerInfo</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">,</span> method<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">const</span> delayTime <span class=\"token operator\">=</span> handlerInfo<span class=\"token operator\">?.</span>delayTime <span class=\"token operator\">||</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">const</span> responseStatus <span class=\"token operator\">=</span> handlerInfo<span class=\"token operator\">?.</span>status <span class=\"token operator\">||</span> <span class=\"token number\">200</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token comment\">// 응답 지연 시간 적용</span>\n      <span class=\"token keyword\">await</span> <span class=\"token function\">delay</span><span class=\"token punctuation\">(</span>delayTime<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token comment\">// 성공적인 요청 처리 후 콜백 함수 실행</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>responseStatus <span class=\"token operator\">!==</span> <span class=\"token number\">400</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        onSuccess<span class=\"token operator\">?.</span><span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">,</span> request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n\n      <span class=\"token comment\">// JSON 형태로 응답 반환</span>\n      <span class=\"token keyword\">return</span> HttpResponse<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span>responseData<span class=\"token punctuation\">[</span>responseStatus<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n        status<span class=\"token operator\">:</span> responseStatus<span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3>리팩토링: 파라미터 객체화</h3>\n<p>함수의 매개변수가 많아짐에 따라 가독성과 사용성 문제가 발생했어요. 몇번째 파라미터에 어떤 값을 넣어줘야 할지 시각적으로 알아보기 어려웠기 때문이에요.</p>\n<p>이를 해결하기 위해 \"객체 비구조화 할당(destructuring)\" 기법을 적용하여 함수 매개변수를 객체화했습니다. 이 접근 방식을 통해 함수 호출 시 매개변수의 순서에 덜 의존할 수 있게 되었고, 코드의 가독성을 향상시킬 수 있었어요.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">// 변경전</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> deleteOurChatHandler <span class=\"token operator\">=</span> <span class=\"token generic-function\"><span class=\"token function\">createApiHandler</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>\n  ChatDeleteParams<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token keyword\">null</span>\n<span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span>\n  <span class=\"token string\">\"/couples/:coupleId/chattings/:chattingId/delete-ours\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"delete\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token number\">200</span><span class=\"token operator\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span>\n    <span class=\"token number\">400</span><span class=\"token operator\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> chattingId <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    chatData <span class=\"token operator\">=</span> chatData<span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span>chat <span class=\"token operator\">=></span> chat<span class=\"token punctuation\">.</span>parentChatting<span class=\"token punctuation\">.</span>id <span class=\"token operator\">!==</span> chattingId<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">// 변경후</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> deleteOurChatHandler <span class=\"token operator\">=</span> <span class=\"token generic-function\"><span class=\"token function\">createApiHandler</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>\n  ChatDeleteParams<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token keyword\">null</span>\n<span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  path<span class=\"token operator\">:</span> <span class=\"token string\">\"/couples/:coupleId/chattings/:chattingId/delete-ours\"</span><span class=\"token punctuation\">,</span>\n  method<span class=\"token operator\">:</span> <span class=\"token string\">\"delete\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">requestHandler</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token number\">200</span><span class=\"token operator\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span>\n    <span class=\"token number\">400</span><span class=\"token operator\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">onSuccess</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> chattingId <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    chatData <span class=\"token operator\">=</span> chatData<span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span>chat <span class=\"token operator\">=></span> chat<span class=\"token punctuation\">.</span>parentChatting<span class=\"token punctuation\">.</span>id <span class=\"token operator\">!==</span> chattingId<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h3>MSW 툴바 컴포넌트 제작하기</h3>\n<p>이제 툴바 컴포넌트를 제작해 볼게요.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">//MSWToolbar.tsx</span>\n<span class=\"token keyword\">import</span> <span class=\"token operator\">...</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">MSWToolbar</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> queryClient <span class=\"token operator\">=</span> <span class=\"token function\">useQueryClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>open<span class=\"token punctuation\">,</span> setOpen<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>items<span class=\"token punctuation\">,</span> setItems<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span>\n    Object<span class=\"token punctuation\">.</span><span class=\"token function\">entries</span><span class=\"token punctuation\">(</span>handlerInfoManager<span class=\"token punctuation\">.</span><span class=\"token function\">getHandlerInfos</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> stagedValue <span class=\"token operator\">=</span> <span class=\"token generic-function\"><span class=\"token function\">useRef</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span><span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">[</span>key<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> SetHandlerParams<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">inputChangeHandler</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>e<span class=\"token operator\">:</span> React<span class=\"token punctuation\">.</span>ChangeEvent<span class=\"token operator\">&lt;</span>HTMLInputElement<span class=\"token operator\">></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> value <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">;</span>\n    <span class=\"token function\">setItems</span><span class=\"token punctuation\">(</span>\n      Object<span class=\"token punctuation\">.</span><span class=\"token function\">entries</span><span class=\"token punctuation\">(</span>handlerInfoManager<span class=\"token punctuation\">.</span><span class=\"token function\">getHandlerInfos</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>path<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n        path<span class=\"token punctuation\">.</span><span class=\"token function\">includes</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">clickApplyBtnHandler</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    Object<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span>stagedValue<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> method<span class=\"token punctuation\">,</span> code<span class=\"token punctuation\">,</span> time <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> stagedValue<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">[</span>path<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n      handlerInfoManager<span class=\"token punctuation\">.</span><span class=\"token function\">setHandlerInfo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> path<span class=\"token punctuation\">,</span> method<span class=\"token punctuation\">,</span> code<span class=\"token punctuation\">,</span> time <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    queryClient<span class=\"token punctuation\">.</span><span class=\"token function\">invalidateQueries</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">setOpen</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token punctuation\">{</span><span class=\"token operator\">!</span>open <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">(</span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">S.ToolbarButton</span></span> <span class=\"token attr-name\">onClick</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">setOpen</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">MSW</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">S.ToolbarButton</span></span><span class=\"token punctuation\">></span></span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n\n      </span><span class=\"token punctuation\">{</span>open <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">(</span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ToolbarBottomSheet</span></span> <span class=\"token attr-name\">open</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>open<span class=\"token punctuation\">}</span></span> <span class=\"token attr-name\">setOpen</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>setOpen<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n          </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">S.SearchBar</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n            </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Icon</span></span> <span class=\"token attr-name\">icon</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>IconSearch<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n            </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">S.Input</span></span> <span class=\"token attr-name\">onChange</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>inputChangeHandler<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n          </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">S.SearchBar</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n\n          </span><span class=\"token punctuation\">{</span>items<span class=\"token punctuation\">.</span>length <span class=\"token operator\">===</span> <span class=\"token number\">0</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">(</span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">S.MessageBox</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">검색 결과가 없어요!</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">S.MessageBox</span></span><span class=\"token punctuation\">></span></span>\n          <span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n\n          </span><span class=\"token punctuation\">{</span>items<span class=\"token punctuation\">.</span>length <span class=\"token operator\">></span> <span class=\"token number\">0</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">(</span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">S.ItemsContainer</span></span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>hidden-scrollbar<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n              </span><span class=\"token punctuation\">{</span>items<span class=\"token punctuation\">.</span><span class=\"token function\">flatMap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>path<span class=\"token punctuation\">,</span> methods<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n                Object<span class=\"token punctuation\">.</span><span class=\"token function\">entries</span><span class=\"token punctuation\">(</span>methods<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>\n                  <span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>method<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> delayTime<span class=\"token punctuation\">,</span> status <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\n                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ToolbarItem</span></span>\n                      <span class=\"token attr-name\">key</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>path<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">-</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>method<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">}</span></span>\n                      <span class=\"token attr-name\">method</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>method<span class=\"token punctuation\">}</span></span>\n                      <span class=\"token attr-name\">path</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>path<span class=\"token punctuation\">}</span></span>\n                      <span class=\"token attr-name\">delayTime</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>delayTime<span class=\"token punctuation\">}</span></span>\n                      <span class=\"token attr-name\">status</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>status<span class=\"token punctuation\">}</span></span>\n                      <span class=\"token attr-name\">onChange</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span>time<span class=\"token punctuation\">,</span> code<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n                        stagedValue<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">[</span>path<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n                          path<span class=\"token punctuation\">,</span>\n                          method<span class=\"token punctuation\">,</span>\n                          code<span class=\"token punctuation\">,</span>\n                          time<span class=\"token punctuation\">,</span>\n                        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n                      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span>\n                    <span class=\"token punctuation\">/></span></span>\n                  <span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">)</span>\n              <span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n            </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">S.ItemsContainer</span></span><span class=\"token punctuation\">></span></span>\n          <span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n\n          </span><span class=\"token punctuation\">{</span>items<span class=\"token punctuation\">.</span>length <span class=\"token operator\">></span> <span class=\"token number\">0</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">(</span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">S.ButtonArea</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n              </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">S.Button</span></span> <span class=\"token attr-name\">onClick</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>clickApplyBtnHandler<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">적용하기</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">S.Button</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n            </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">S.ButtonArea</span></span><span class=\"token punctuation\">></span></span>\n          <span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">ToolbarBottomSheet</span></span><span class=\"token punctuation\">></span></span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> MSWToolbar<span class=\"token punctuation\">;</span></code></pre></div>\n<div align='center'>\n<span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/team-blog/static/6d015c605644e2dfa852bf9b7c0cf265/e0a8c/selector-image.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 71.76470588235294%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsTAAALEwEAmpwYAAACHklEQVR42o1RaW8SURSdn2VSq2nqwAwww5utA7Mx7ANMDKVusYBxqSlpLZuGD8QtRlusYjDFlRDxu/1NnpmJaZv6oSeTl/venXvvOfdQyWRy+/HObmvPcUqILStlGIZpmpYPBLquC6LAEy5OeFmWdR9rPijTsN6+Hh3uj2/euIWyfD5v23Ymk0FQKBRyuRwaKGHi6k5WslROXK/Vaus1pFRVpQghDBPGx3Ec4vhZ4CUWjfaZzrfCl3H8wxN55+jH0fGf48VigRkUmGCGU3QSiYQoitJZIIsWa9fIhn29qlfUqOSUnGq1Wi6XoZGy7fR08v3n11+NzSaaVSoVUHUcB4HruvgJjwy9mk1bdkpnQ/TKP3ia0d7wYOKCOYqiBGcAPAqEcGGmmMlosmxp2sfxeD6fTyaTVCrlaWZZBpp5ngdtcgogLAhCLBaL0DTWGGdZmZB2uz0cDnu9HgZSoP7w/tbWo21YBW+wRqw6m80WfeCKCQLHpQ0DY0WeD8zDqj3almm9e/P+8ODTndt3XbdSKpWQCMxEb80HjFj1AXbggivoeMWeGT5AEmqRO808oN3pdKbT6Ww263a7o9HoRHNgD8pw/tcqtKjX6xA5GAwajWan3X3x/OXT/jNP8/mC8/WRSCQUCtE0zbLslZXLS8uXlq8uebTFCwAtFFkRRcHQrGHr83739969V5IsXKg4ABFIQtVam8P+g4Pmxq4oCX8BbBQ/DrcTgOQAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='selector image' title='' src='/team-blog/static/6d015c605644e2dfa852bf9b7c0cf265/ca1dc/selector-image.png' srcset='/team-blog/static/6d015c605644e2dfa852bf9b7c0cf265/e7570/selector-image.png 170w,\n/team-blog/static/6d015c605644e2dfa852bf9b7c0cf265/f46e7/selector-image.png 340w,\n/team-blog/static/6d015c605644e2dfa852bf9b7c0cf265/ca1dc/selector-image.png 680w,\n/team-blog/static/6d015c605644e2dfa852bf9b7c0cf265/e0a8c/selector-image.png 998w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n</div>\n<p>툴바 컴포넌트의 전체 코드와 툴바의 옵션 선택 부분입니다. 코드의 동작 과정을 자세히 살펴볼게요.</p>\n<ul>\n<li><code class=\"language-text\">handlerInfoManager.getHandlerInfos()</code> 를 사용해 handler의 path와 method를 받아오고 있어요.</li>\n<li><code class=\"language-text\">inputChangeHandler</code> 는 검색 창의 input value가 변경되었을 때 호출되는 함수에요. 텍스트를 입력할 때마다 입력된 경로가 포함되는 요소들을 보여줍니다.</li>\n<li>각 핸들러에 대응되는 드롭다운 메뉴에서 옵션을 선택하면, 옵션을 stagedValue 변수에 저장합니다.</li>\n<li>적용하기 버튼을 누르면, <code class=\"language-text\">clickApplyBtnHandler</code> 가 실행되어 stagedValue에 저장된 옵션들(delay와 status code)이 실제 핸들러에 적용됩니다. 현재 그로잉 프로젝트에서는 react-query를 사용하고 있어서 옵션들을 적용한 후 바로 데이터를 refetch하도록 만들기 위해 마지막으로 <code class=\"language-text\">queryClient.invalidateQueries()</code> 를 실행해주고 있어요.</li>\n<li>real은 현실적인 응답 시간 정도를 지연해주는 옵션입니다. infinite는 응답을 무한하게 delay 시켜주는 옵션입니다. 이는 로딩 상태가 잘 표시되는 지 등을 확인할 때 유용하게 사용할 수 있어요.</li>\n</ul>\n<p>코드에서 한 가지 생각해볼 점이 있었어요.</p>\n<p><code class=\"language-text\">const stagedValue = useRef&lt;{[key: string]: SetHandlerParams;}>({});</code> 부분에서 왜 useRef 훅을 사용했을까요? stagedValue를 useRef없이 사용하면, 검색을 할 때마다 MSWToolbar 컴포넌트가 재실행 되어 stagedValue가 빈 객체로 초기화됩니다. 이를 방지하고자 useState 훅을 사용하면, stagedValue가 변경 될 때마다 리렌더링이 발생해요. 그래서 컴포넌트가 재실행 되더라도 stagedValue값을 유지하면서, stagedValue가 변경되더라도 리렌더링이 일어나지 않게 하기 위해 useRef hook을 사용했어요.</p>\n<h3>툴바는 리액트 돔 트리에서 어디에 위치해야 할까?</h3>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">const</span> root <span class=\"token operator\">=</span> ReactDOM<span class=\"token punctuation\">.</span><span class=\"token function\">createRoot</span><span class=\"token punctuation\">(</span>document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"root\"</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> HTMLElement<span class=\"token punctuation\">)</span>\n\n<span class=\"token function\">enableMocking</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  root<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">React.StrictMode</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">BrowserRouter</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">QueryClientProvider</span></span> <span class=\"token attr-name\">client</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>queryClient<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n          </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ReactQueryDevtools</span></span> <span class=\"token attr-name\">initialIsOpen</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n          </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">GlobalStyle</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n          </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ThemeProvider</span></span> <span class=\"token attr-name\">theme</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>myTheme<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n            </span><span class=\"token punctuation\">{</span>process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">NODE_ENV</span> <span class=\"token operator\">===</span> <span class=\"token string\">\"development\"</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">MSWToolbar</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n            </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">AsyncBoundary</span></span>\n              <span class=\"token attr-name\">pendingFallback</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">FullScreenLoading</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">}</span></span>\n              <span class=\"token attr-name\">rejectedFallback</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> error<span class=\"token punctuation\">,</span> resetErrorBoundary <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\n                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">FullScreenError</span></span>\n                  <span class=\"token attr-name\">error</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>error<span class=\"token punctuation\">}</span></span>\n                  <span class=\"token attr-name\">resetErrorBoundary</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>resetErrorBoundary<span class=\"token punctuation\">}</span></span>\n                <span class=\"token punctuation\">/></span></span>\n              <span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span>\n            <span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n              </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">App</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n            </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">AsyncBoundary</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n          </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">ThemeProvider</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">QueryClientProvider</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">BrowserRouter</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">React.StrictMode</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>다음은 MSWToolbar 컴포넌트의 위치를 선택할 때 고려한 내용들이에요.</p>\n<ol>\n<li>MSWToolbar는 dev모드에서만 뜨도록 해야 합니다.</li>\n<li>MSWToolbar는 런타임에 영향을 주지 않아야 합니다.</li>\n<li>MSWToolbar에서 styled-component의 theme을 이용하고 있어 ThemeProvider 안에 들어가야 합니다.</li>\n<li>react query로 관리되고 있는 서버 데이터의 invalidate해줄 수 있어야 하므로 QueryClientProvider 안에 들어가야 합니다.</li>\n</ol>\n<p>1번을 위해 NODE_ENV에 따라 Toolbar를 표시해 주었고, 2번,3번을 고려해 AsyncBoundary밖이면서 ThemeProvider와 QueryClientProvider의 안에 위치 시켰어요. MSWToolbar를 이용해 의도적으로 error 상황을 테스트할 때, 그로잉 프로젝트에서 AsyncBoudary와 함께 사용하고 있는 FullScreenError가 뜰 수 있어요. 이때, MSWToolbar는 런타임에서 발생하는 에러 범위 밖에서 상태코드를 200으로 바꿔줄 수 있어야 하기 때문에 AsyncBoundary밖에 있어야 해요.</p>\n<h2>최종 완성</h2>\n<h3>시연영상</h3>\n<div align='center'>\n    <img src='/team-blog/static/msw-5e1136c34082572c62501f89ce7736f0.gif' width='300px'>\n</div>\n<h2>결론</h2>\n<p>MSW와 MSW를 활용한 툴바의 도입을 성공했습니다. 도입 전에는 로딩 상태 확인을 위해 크롬 devtools를 활용했는데 툴바를 활용해 런타임에서 쉽게 delay를 조정할 수 있게 되었습니다. 그리고 에러가 발생하는 상황을 쉽게 재현하고, 다시 응답에 성공하도록 되돌리는 것도 간편해졌습니다.</p>\n<p>MSW를 사용한 모킹은 api path를 기준으로 이루어지기 때문에 매우 직관적이고 코드 작성도 쉬웠던 것 같습니다.</p>","frontmatter":{"title":"MSW로 mocking을 해보자 ","date":"February 24, 2024","update":"February 24, 2024","tags":["growing","msw","mocking"],"series":null},"fields":{"slug":"/msw-toolbar/","readingTime":{"minutes":38.85}}},"seriesList":{"edges":[{"node":{"id":"3f809cf2-62db-574a-a134-90ab9a211f30","fields":{"slug":"/folder-structure/"},"frontmatter":{"title":"행복한 개발을 위한 폴더 구조는?"}}},{"node":{"id":"d186e685-6156-5a77-a167-9ec803e07f80","fields":{"slug":"/msw-toolbar/"},"frontmatter":{"title":"MSW로 mocking을 해보자 "}}}]},"previous":{"fields":{"slug":"/folder-structure/"},"frontmatter":{"title":"행복한 개발을 위한 폴더 구조는?"}},"next":null},"pageContext":{"id":"d186e685-6156-5a77-a167-9ec803e07f80","series":null,"previousPostId":"3f809cf2-62db-574a-a134-90ab9a211f30","nextPostId":null}},"staticQueryHashes":[],"slicesMap":{}}